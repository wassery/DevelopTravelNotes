参考：

unity2017以上版本的Assetbundle打包
https://blog.csdn.net/elineSea/article/details/79866758

Unity3d 5.x AssetBundle打包与加载
https://www.cnblogs.com/lan-yt/p/7787290.html

Unity中如何使用AssetBundle打包
http://gad.qq.com/article/detail/287854

Unity官方文档-BuildPipeline.BuildPlayer
https://docs.unity3d.com/ScriptReference/BuildPipeline.BuildPlayer.html


代码：

AssetBundlesEditor.cs

```
using UnityEngine;
using UnityEditor;
using System.IO;

public class AssetBundlesEditor : Editor
{
    [MenuItem("AssetBundles/Build AB for Android")]
    static void BuildAB()
    {
        string dir = Application.streamingAssetsPath;
        if (!Directory.Exists(dir))
        {
            Directory.CreateDirectory(dir);
        }
        BuildPipeline.BuildAssetBundles(dir, BuildAssetBundleOptions.None, BuildTarget.Android);
        AssetDatabase.SaveAssets();
        AssetDatabase.Refresh();
        Debug.LogWarning("Build AB succeeded");
    }

    [MenuItem("AssetBundles/Build Game for Android")]
    static void BuildGame()
    {
        BuildPlayerOptions buildPlayerOptions = new BuildPlayerOptions();
        buildPlayerOptions.scenes = new[] { "Assets/Scenes/Main.unity" };
        buildPlayerOptions.locationPathName = "../package/assetbundle_test.apk";
        buildPlayerOptions.target = BuildTarget.Android;
        buildPlayerOptions.options = BuildOptions.None;

        string strResult = BuildPipeline.BuildPlayer(buildPlayerOptions);
        if (string.IsNullOrEmpty(strResult))
        {
            Debug.LogWarning("Build Game succeeded");
        }
        else
        {
            Debug.LogWarning("Build Game failed: " + strResult);
        }
    }
}
```

 AssetBundlesManager.cs

```
using UnityEngine;
using UnityEngine.Networking;
using UnityEngine.UI;
using System.Collections;
using System.Collections.Generic;
using System.Text;

public class AssetBundlesManager : MonoBehaviour
{
    private StringBuilder _remotePath = new StringBuilder();
    private StringBuilder _localPath = new StringBuilder();
    private AssetBundleManifest _manifest = null;

    public Text _text = null;

    IEnumerator Start()
    {
        _localPath.Append(Application.streamingAssetsPath + "/");
        if (Application.platform == RuntimePlatform.Android)
        {
            _remotePath.Append(_localPath);
        }
        else
        {
            _remotePath.Append(@"file:///" + _localPath);
        }

        _text.text = "";

        this.Print("_localPath：" + _localPath);
        this.Print("_remotePath：" + _remotePath);

        // 读取manifest文件
        AssetBundle manifestAB = AssetBundle.LoadFromFile(_localPath + "StreamingAssets");
        _manifest = manifestAB.LoadAsset<AssetBundleManifest>("AssetBundleManifest");

        // 加载指定资源
        yield return LoadAB("material.ab");
        // 加载指定资源并实例化
        yield return LoadAB("GORoot", "cube.ab");
        yield return LoadAB("UIRoot", "mainui.ab");
    }

    // 加载指定资源
    IEnumerator LoadAB(string abName)
    {
        // AssetBundle资源路径（服务器地址或该资源的完整路径）
        string uri = _remotePath + abName;
        this.Print("uri：" + uri);

        // UnityWebRequest取代www下载
        UnityWebRequest request = UnityWebRequest.GetAssetBundle(uri);
        yield return request.SendWebRequest();

        // 得到AssetBundle对象
        AssetBundle ab = DownloadHandlerAssetBundle.GetContent(request);

        // 读取AssetBundle里面的所有资源
        Object[] objs = ab.LoadAllAssets();

        // 加载依赖资源
        string[] depends = _manifest.GetAllDependencies(abName);
        foreach (string name in depends)
        {
            //打印指定资源的依赖AssetBundle资源
            string sub_uri = _localPath + name;
            this.Print("sub：" + sub_uri);
            //根据这个依赖包继续加载AssetBundle资源
            AssetBundle sub_ab = AssetBundle.LoadFromFile(_localPath + name);
            if (sub_ab != null)
            {
                sub_ab.LoadAllAssets();
                this.Print("sub_ab：" + sub_ab.ToString());
            }
        }
    }

    // 加载指定资源并实例化
    IEnumerator LoadAB(string rootName, string abName)
    {
        // AssetBundle资源路径（服务器地址或该资源的完整路径）
        string uri = _remotePath + abName;
        this.Print("uri：" + uri);

        // UnityWebRequest取代www下载
        UnityWebRequest request = UnityWebRequest.GetAssetBundle(uri);
        yield return request.SendWebRequest();

        // 得到AssetBundle对象
        AssetBundle ab = DownloadHandlerAssetBundle.GetContent(request);

        // 读取AssetBundle里面的所有资源
        Object[] objs = ab.LoadAllAssets();

        // 加载依赖资源
        string[] depends = _manifest.GetAllDependencies(abName);
        foreach (string name in depends)
        {
            //打印指定资源的依赖AssetBundle资源
            string sub_uri = _localPath + name;
            this.Print("sub：" + sub_uri);
            //根据这个依赖包继续加载AssetBundle资源
            AssetBundle sub_ab = AssetBundle.LoadFromFile(_localPath + name);
            if (sub_ab != null)
            {
                sub_ab.LoadAllAssets();
                this.Print("sub_ab：" + sub_ab.ToString());
            }
        }

        // 实例化
        foreach (Object o in objs)
        {
            GameObject go = (GameObject)Instantiate(o);//实例化对象，根据对象的类型进行转换
            go.transform.SetParent(GameObject.Find(rootName).transform);
            go.transform.localPosition = Vector3.zero;
        }
    }

    void Print(string str)
    {
        Debug.Log(str);
        if (_text.text != "")
            _text.text = _text.text + "\n\n";
        _text.text = _text.text + str;
    }
}
```
